<!DOCTYPE html>
<html>
<head>
  <title>Teste de API</title>
</head>
<body>
  <h1>Teste de API</h1>

  <button onclick="registrar()">Registrar Usuário</button>
  <button onclick="login()">Login</button>
  <button onclick="buscarUsuarios()">Buscar Usuários</button>

  <pre id="resultado"></pre>

  <script>
    // Função para registrar usuário
    async function registrar() {
      const resposta = await fetch('https://gestao-facil-fuszo02rk-erico-de-freitas-netos-projects.vercel.app/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: 'netofreitas@gestaofacil.com', senha: '123456', cargo: 'admin' })
      });

      const dados = await resposta.json();
      console.log('Registro:', dados);

      if (dados.token) {
        localStorage.setItem('token', dados.token);
        alert('Usuário registrado e token salvo!');
      } else {
        alert('Falha no registro');
      }
    }

    // Função para login
    async function login() {
      const resposta = await fetch('https://gestao-facil-fuszo02rk-erico-de-freitas-netos-projects.vercel.app/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: 'netofreitas@gestaofacil.com', senha: '123456' })
      });

      const dados = await resposta.json();
      console.log('Login:', dados);

      if (dados.token) {
        localStorage.setItem('token', dados.token);
        alert('Login bem-sucedido! Token salvo.');
      } else {
        alert('Falha no login');
      }
    }

    // Função para buscar usuários (rota protegida)
    async function buscarUsuarios() {
      const token = localStorage.getItem('token');
      if (!token) {
        alert('Faça login primeiro!');
        return;
      }

      try {
        const resposta = await fetch('https://gestao-facil-fuszo02rk-erico-de-freitas-netos-projects.vercel.app/api/v1/usuarios', {
          method: 'GET',
          headers: { 'Authorization': `Bearer ${token}` }
        });

        if (!resposta.ok) throw new Error(`Erro ${resposta.status}`);

        const dados = await resposta.json();
        document.getElementById('resultado').textContent = JSON.stringify(dados, null, 2);
      } catch (erro) {
        document.getElementById('resultado').textContent = erro.message;
      }
    }
  </script>
</body>
</html>
